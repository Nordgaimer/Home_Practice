package JdbcUtils;

import java.sql.*;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

import Exceptions.DBSystemException;

/**
 * Created by Елена on 27.03.2014.
 */
public class DAO_Manager  {
    private static final String DRIVER_CLASS_NAME = "com.microsoft.sqlserver.jdbc.SQLServerDriver";
    private static final String JDBC_URL = "jdbc:sqlserver://localhost;instance=MS2008R2E;databaseName=GMSSample38;user=sa;password=QQQqqq123";


    private static final String SELECT_LIST_ALL_DOCUMENTS_CHID= "SELECT ChID FROM t_Ven";
    private static final String INSERT_USER_SQL = "INSERT INTO user (user_id, login, email) values (?,?,?);";
    private static final String DELETE_BY_ID_SQL = "DELETE FROM user WHERE  user_id = ?";
    private static final String SELECT_BY_ID_SQL = "SELECT id FROM User WHERE user_id = ? ";
    private static final String SELECT_BY_LOGIN_SQL = "SELECT login FROM User WHERE login=?";


    static {
        ConnectionManager.initDriver(DRIVER_CLASS_NAME);
    }

    private Connection getConnection() throws DBSystemException {
        try {
            return DriverManager.getConnection(JDBC_URL);
        } catch (SQLException e) {
            throw new DBSystemException("Can't connect to SQL");
        }
    }

    
    public List<Integer> getDocsChIdToList() throws DBSystemException {
        Connection conn = getConnection();
        Statement stat = null;
        ResultSet rs = null;

        try {
            conn.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE);
            conn.setAutoCommit(false);
            stat = conn.createStatement();
            rs = stat.executeQuery(SELECT_LIST_ALL_DOCUMENTS_CHID);
            List<Integer> result = new LinkedList<Integer>();
            while (rs.next()) {
                int ChID = rs.getInt(1);
                result.add(ChID);
            }
            conn.commit();
            return result;


        } catch (SQLException e) {
            ConnectionManager.rollbackQuietly(conn);


            throw new DBSystemException("Cant exequte SQL");
        } finally {
        	ConnectionManager.closeQuietly(rs);
        	ConnectionManager.closeQuietly(conn);
        	ConnectionManager.closeQuietly(stat);

        }
    }

//    public void getAllUsers() throws DBSystemException {
//        Connection conn = getConnection();
//        Statement stat = null;
//        ResultSet rs = null;
//
//        try {
//
//            conn.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE);
//            conn.setAutoCommit(false);
//            stat = conn.createStatement();
//            rs = stat.executeQuery(SELECT_ALL_SQL);
//            List<User> result = new ArrayList<User>();
//            while (rs.next()) {
//                System.out.println(rs.getInt("supplierID"));
//            }
//
//            conn.commit();
//
//
//        } catch (SQLException e) {
//        	getUtil.rollbackQuietly(conn);
//            throw new DBSystemException("Cant exequte SQL");
//        } finally {
//        	getUtil.closeQuietly(rs);
//        	getUtil.closeQuietly(conn);
//        	getUtil.closeQuietly(stat);
//
//        }
//    }

//    @Override
//    public void deleteById(String id) throws DBSystemException {
//        Connection conn = getConnection();
//        PreparedStatement preparedStatement = null;
//
//
//        try {
//            conn.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE);
//            conn.setAutoCommit(false);
//            preparedStatement = conn.prepareStatement(DELETE_BY_ID_SQL);
//            preparedStatement.setString(1,id);
//            preparedStatement.executeUpdate();
//            System.out.println("User deleted.");
//            conn.commit();
//
//        } catch (SQLException e) {
//        	getUtil.rollbackQuietly(conn);
//            throw new DBSystemException("Can't exequte SQL");
//        } finally {
//
//        	getUtil.closeQuietly(conn);
//        	getUtil.closeQuietly(preparedStatement);
//
//        }
//
//    }
//
//    public void insert_user(User user) throws DBSystemException {
//        Connection conn = null;
//        PreparedStatement preparedStatement = null;
//        try {
//            String id  = String.valueOf(user.getId());
//            conn = getConnection();
//            preparedStatement= conn.prepareStatement(INSERT_USER_SQL);
//            preparedStatement.setString(1,id);
//            preparedStatement.setString(2,user.getLogin());
//            preparedStatement.setString(3,user.getEmail());
//            preparedStatement.execute();
//            System.out.println("User "+user.getLogin()+" inserted.");
//        } catch (SQLException e) {
//            new DBSystemException("Cant insert "+user.getLogin()+" SQL");
//            e.printStackTrace();
//        }
//
//    }
}
